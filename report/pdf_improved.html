<!doctype html><html lang="ko"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ïã¨Ï∏µ Î∂ÑÏÑù PDF</title>
<link rel="stylesheet" href="/style.css"/>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head><body>
<div class="wrap"><div class="grid" style="grid-template-columns:minmax(0,1fr)">
<main class="card hero" id="reportCard">
  <h1 id="title">Î¶¨Ìè¨Ìä∏ Ï§ÄÎπÑ Ï§ë‚Ä¶</h1>
  <p id="meta"></p>
  <div class="premium-upsell">
    <p class="premium-label">Î¶¨Ìè¨Ìä∏ ÎØ∏Î¶¨Î≥¥Í∏∞</p>
    <ul id="reportList"></ul>
  </div>
  <div class="btns">
    <button class="primary" id="btnPdf">PDF Îã§Ïö¥Î°úÎìú</button>
    <a class="pill" href="/">üè† Ìôà</a>
  </div>
</main></div></div>

<script>
(function () {
  const p = new URLSearchParams(location.search);
  const test = p.get('test') || '';
  const result = p.get('result') || '';
  const plan = p.get('plan') || 'starter';
  const draft = p.get('draft') || `${test}:${result}:${plan}`;

  // NOTE: ÌòÑÏû¨ Í≤∞Ï†ú Í≤ÄÏ¶ùÏù¥ localStorage Í∏∞Î∞òÏù¥Îùº Ïö∞ÌöåÍ∞Ä Îß§Ïö∞ ÏâΩÏäµÎãàÎã§.
  // Ïã§Ï†ú Ïú†Î£å ÏÑúÎπÑÏä§ÎùºÎ©¥ ÏÑúÎ≤ÑÏóêÏÑú Í≤∞Ï†ú Í≤ÄÏ¶ù(ÏòÅÏàòÏ¶ù/ÏõπÌõÖ) ÌõÑ ÌÜ†ÌÅ∞ÏùÑ Î∞úÍ∏âÌïòÎäî Î∞©ÏãùÏúºÎ°ú Î∞îÍæ∏Îäî Í≤ÉÏùÑ Í∂åÏû•Ìï©ÎãàÎã§.
  const purchase = JSON.parse(localStorage.getItem(`reportPurchase:${draft}`) || 'null');
  if (!purchase?.paid) {
    alert('Í≤∞Ï†ú Ï†ïÎ≥¥Í∞Ä ÌôïÏù∏ÎêòÏßÄ ÏïäÏïÑ Î¶¨Ìè¨Ìä∏Î•º Ïó¥ Ïàò ÏóÜÏäµÎãàÎã§.');
    location.href = '/';
    return;
  }

  const draftData = JSON.parse(localStorage.getItem(`reportDraft:${draft}`) || 'null');
  const resultTitle = draftData?.resultTitle || result || 'Í≤∞Í≥º';
  const testTitle = draftData?.testTitle || test || 'ÌÖåÏä§Ìä∏';
  const data = draftData?.result || {};

  const planName = plan === 'full' ? 'Full' : 'Starter';
  document.getElementById('title').textContent = `${resultTitle} ${planName} PDF Î¶¨Ìè¨Ìä∏`;
  const today = new Date();
  document.getElementById('meta').textContent = `${testTitle} ¬∑ Í≤∞Ï†úÎ≤àÌò∏ ${purchase.paymentId} ¬∑ ÏÉùÏÑ±Ïùº ${today.toLocaleDateString('ko-KR')}`;

  // ---------- helpers ----------
  const escapeHtml = (s) =>
    String(s ?? '').replace(/[&<>"']/g, (ch) => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
    }[ch]));

  const hashString = (str) => {
    let h = 2166136261;
    for (let i = 0; i < str.length; i++) {
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return h >>> 0;
  };

  const mulberry32 = (a) => () => {
    a |= 0; a = a + 0x6D2B79F5 | 0;
    let t = Math.imul(a ^ a >>> 15, 1 | a);
    t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  };

  const rng = mulberry32(hashString(draft));
  const pick = (arr, fallback = '') => (Array.isArray(arr) && arr.length ? arr[Math.floor(rng() * arr.length)] : fallback);
  const uniq = (arr) => Array.from(new Set((arr || []).filter(Boolean).map(x => String(x).trim()).filter(Boolean)));

  const toArray = (v) => Array.isArray(v) ? v : [];
  const strengths = toArray(data.strengths);
  const pitfalls = toArray(data.pitfalls);
  const routine = toArray(data.routine);
  const keywords = uniq(toArray(data.keywords));

  // ---------- domain profile ----------
  const TEST_PROFILES = {
    travel:{focus:'Ïó¨Ìñâ',outcome:'ÎßåÏ°±ÎèÑ',context:'ÏùºÏ†ï/ÎèôÏÑ†'},
    love:{focus:'Í¥ÄÍ≥Ñ',outcome:'Í¥ÄÍ≥Ñ ÏïàÏ†ïÍ∞ê',context:'Í∞êÏ†ï/ÏÜåÌÜµ'},
    spend:{focus:'ÏÜåÎπÑ',outcome:'ÏßÄÏ∂ú Ìö®Ïú®',context:'Íµ¨Îß§/Í≤∞Ï†ú'},
    stress:{focus:'Ïä§Ìä∏Î†àÏä§',outcome:'ÌöåÎ≥µ ÌÉÑÎ†•ÏÑ±',context:'ÏóÖÎ¨¥ ÏïïÎ∞ï'},
    money:{focus:'ÏûêÏÇ∞Í¥ÄÎ¶¨',outcome:'Ï†ÄÏ∂ï ÏßÄÏÜçÎ•†',context:'ÏòàÏÇ∞/Ï†ÄÏ∂ï'},
    work:{focus:'ÏóÖÎ¨¥',outcome:'ÏÑ±Í≥º Ïû¨ÌòÑÏÑ±',context:'ÌòëÏóÖ/Ïã§Ìñâ'},
    spendlevel:{focus:'ÏÜåÎπÑ Î†àÎ≤®',outcome:'Ï≤¥Í∞ê ÎßåÏ°±',context:'Í∞ÄÍ≤©/Í∞ÄÏπò'},
    office:{focus:'ÏßÅÏû• ÏÉùÏ°¥',outcome:'Ï°∞ÏßÅ Ï†ÅÏùëÎ†•',context:'Í¥ÄÍ≥Ñ/ÏÑ±Í≥º'},
    habit:{focus:'Î£®Ìã¥',outcome:'Ïã§Ï≤ú Ïú†ÏßÄÏú®',context:'Ï∞©Ïàò/ÏßÄÏÜç'},
    invest:{focus:'Ìà¨Ïûê',outcome:'Î≥ÄÎèôÏÑ± ÎåÄÏùëÎ†•',context:'ÏßÑÏûÖ/Ï≤≠ÏÇ∞'},
    gift:{focus:'ÏÑ†Î¨º',outcome:'ÏÑ†ÌÉù Ï†ïÌôïÎèÑ',context:'Ï∑®Ìñ•/ÏÉÅÌô©'},
    mood:{focus:'ÌöåÎ≥µ',outcome:'Ï†ïÏÑú ÌöåÎ≥µÏÜçÎèÑ',context:'ÌîºÎ°ú/Í∞êÏ†ï'},
    sleep:{focus:'ÏàòÎ©¥',outcome:'Ïª®ÎîîÏÖò ÏïàÏ†ïÏÑ±',context:'Ï∑®Ïπ®/Í∏∞ÏÉÅ'},
    study:{focus:'ÌïôÏäµ',outcome:'ÌïôÏäµ ÎàÑÏ†ÅÎüâ',context:'Í≥ÑÌöç/Î≥µÏäµ'},
    exercise:{focus:'Ïö¥Îèô',outcome:'Ïö¥Îèô ÏßÄÏÜçÏÑ±',context:'Í∞ïÎèÑ/ÎπàÎèÑ'},
    food:{focus:'ÏãùÏÇ¨',outcome:'ÏãùÏäµÍ¥Ä Í∑†Ìòï',context:'Î©îÎâ¥/Ìå®ÌÑ¥'},
    friend:{focus:'ÏπúÍµ¨Í¥ÄÍ≥Ñ',outcome:'Í¥ÄÍ≥Ñ ÎßåÏ°±ÎèÑ',context:'ÎåÄÌôî/Í±∞Î¶¨Í∞ê'},
    weekend:{focus:'Ï£ºÎßêÌôúÏö©',outcome:'Ï£ºÍ∞Ñ ÌöåÎ≥µÎ†•',context:'Ìú¥Ïãù/ÌôúÎèô'},
    communication:{focus:'ÏÜåÌÜµ',outcome:'Ï†ÑÎã¨ Ï†ïÌôïÎèÑ',context:'ÌëúÌòÑ/Í≤ΩÏ≤≠'},
    fashion:{focus:'Ìå®ÏÖò',outcome:'Ïä§ÌÉÄÏùº ÏùºÍ¥ÄÏÑ±',context:'ÏÑ†ÌÉù/Ï°∞Ìï©'},
    pet:{focus:'Î∞òÎ†§',outcome:'ÎèåÎ¥Ñ ÏïàÏ†ïÏÑ±',context:'ÍµêÍ∞ê/Í¥ÄÎ¶¨'},
    movie:{focus:'ÏΩòÌÖêÏ∏† Ï∑®Ìñ•',outcome:'ÎßåÏ°± Ïû¨ÌòÑÏÑ±',context:'ÏÑ†ÌÉù/Í∞êÏÉÅ'}
  };
  const profile = TEST_PROFILES[test] || {focus:'ÏùºÏÉÅ',outcome:'Ïã§Ìñâ ÎßåÏ°±ÎèÑ',context:'ÏÑ†ÌÉù/Ïã§Ìñâ'};

  const CATEGORY_BY_TEST = {
    // Í¥ÄÍ≥Ñ
    love:'relationship', friend:'relationship', communication:'relationship',
    // Îèà
    spend:'money', money:'money', invest:'money', spendlevel:'money',
    // Ïùº/ÌïôÏäµ
    work:'work', office:'work', study:'work',
    // Ïõ∞Îπô
    stress:'wellbeing', mood:'wellbeing', sleep:'wellbeing', exercise:'wellbeing', food:'wellbeing', habit:'wellbeing', weekend:'wellbeing',
    // ÎùºÏù¥ÌîÑ
    travel:'lifestyle', fashion:'lifestyle', gift:'lifestyle', movie:'lifestyle', pet:'lifestyle'
  };
  const category = CATEGORY_BY_TEST[test] || 'general';

  const PLAYBOOKS = {
    relationship: {
      metrics: ['Í≤ΩÍ≥Ñ ÏÑ§Ï†ï', 'Í∞êÏ†ï ÌëúÌòÑÏùò Î™ÖÎ£åÎèÑ', 'Í∞àÎì± ÌõÑ Î≥µÍµ¨ ÏÜçÎèÑ'],
      goodMoves: [
        'Í∞êÏ†ïÏùÑ ‚ÄúÏÇ¨Ïã§+ÎäêÎÇå+ÏöîÏ≤≠‚Äù 3Îã®ÏúºÎ°ú ÎßêÌïòÍ∏∞',
        'Ï¢ãÏïòÎçò ÌñâÎèôÏùÑ Î®ºÏ†Ä Ïπ≠Ï∞¨Ìïú Îí§ Í∞úÏÑ†Ï†ê 1Í∞úÎßå Ï†úÏïàÌïòÍ∏∞',
        'Ïó∞ÎùΩ/ÎßåÎÇ®Ïùò Í∏∞Ï§ÄÏùÑ Ïà´ÏûêÎ°ú Ìï©ÏùòÌïòÍ∏∞(Ï£º nÌöå Îì±)'
      ],
      recovery: [
        'ÏßÄÍ∏à Í≤∞Î°†ÏùÑ ÎÇ¥Î¶¨Í∏∞Î≥¥Îã§ ‚ÄúÏ†ïÎ¶¨ ÌõÑ Îã§Ïãú ÏñòÍ∏∞‚ÄùÎ•º ÏÑ†Ïñ∏',
        'ÏÉÅÎåÄÏùò ÏùòÎèÑÎ•º Ï∂îÏ∏°ÌïòÏßÄ ÎßêÍ≥† ÏßàÎ¨∏ 1Í∞úÎ°ú ÌôïÏù∏',
        'ÎÇ¥Í∞Ä ÏõêÌïòÎäî ÌñâÎèôÏùÑ Ìïú Î¨∏Ïû•ÏúºÎ°ú Íµ¨Ï≤¥Ìôî'
      ],
      scripts: [
        'ÎÇòÎäî (ÏÇ¨Ïã§)ÏùÑ Î≥¥Í≥† (ÎäêÎÇå)Ïù¥ Îì§ÏóàÏñ¥. Îã§ÏùåÏóî (ÏöîÏ≤≠)Ìï¥Ï§Ñ Ïàò ÏûàÏùÑÍπå?',
        'ÏßÄÍ∏àÏùÄ Í∞êÏ†ïÏù¥ Ïò¨ÎùºÏôÄÏÑú Ï†ïÎ¶¨Í∞Ä ÌïÑÏöîÌï¥. 30Î∂Ñ Îí§Ïóê Îã§Ïãú ÏñòÍ∏∞ÌïòÏûê.',
        'ÎÇ¥Í∞Ä Ï§ëÏöîÌïòÍ≤å ÏÉùÍ∞ÅÌïòÎäî Í±¥ (Í∏∞Ï§Ä)Ïù¥Ïïº. Ïö∞Î¶¨ Í∏∞Ï§ÄÏùÑ ÎßûÏ∂∞Î≥¥Ïûê.'
      ]
    },
    money: {
      metrics: ['Í≥†Ï†ïÎπÑ Í¥ÄÎ¶¨', 'Ï∂©ÎèôÍµ¨Îß§ ÎπàÎèÑ', 'Ï†ÄÏ∂ï ÏûêÎèôÌôî ÏàòÏ§Ä'],
      goodMoves: [
        'ÏòàÏÇ∞ÏùÑ ‚ÄúÍ≥†Ï†ïÎπÑ/ÌïÑÏàò/ÎßåÏ°±‚Äù 3ÌÜµÏû•ÏúºÎ°ú Î∂ÑÎ¶¨',
        'Íµ¨Îß§ Ï†Ñ 24ÏãúÍ∞Ñ Î£∞(Ïû•Î∞îÍµ¨Îãà ÏàôÏÑ±) Ï†ÅÏö©',
        'Ìïú Îã¨ 1Ìöå ‚ÄúÏπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Í≤∞ÏÇ∞‚ÄùÏúºÎ°ú Ìå®ÌÑ¥ Ï∞æÍ∏∞'
      ],
      recovery: [
        'Ïù¥Î≤à Îã¨ Î™©ÌëúÎ•º ‚ÄúÍ∏àÏï°‚Äù ÎåÄÏã† ‚ÄúÌöüÏàò‚ÄùÎ°ú Ï†ÑÌôò(Ïòà: Ïô∏Ïãù 4Ìöå)',
        'ÏßÄÏ∂ú Ìä∏Î¶¨Í±∞(ÌîºÍ≥§/Ïä§Ìä∏Î†àÏä§/ÏÑ∏Ïùº) ÌïòÎÇòÎßå Î®ºÏ†Ä Ï∞®Îã®',
        'Í≤∞Ï†ú ÏàòÎã®ÏùÑ 1Í∞úÎ°ú Í≥†Ï†ïÌï¥ Í∏∞Î°ù ÎàÑÎùΩ Ï§ÑÏù¥Í∏∞'
      ],
      scripts: [
        'Ïò§ÎäòÏùÄ ÏòàÏÇ∞ Î≤îÏúÑ ÏïàÏóêÏÑú ‚ÄúÎßåÏ°± ÏßÄÏ∂ú‚Äù 1Í∞úÎßå ÏÑ†ÌÉùÌï†Í≤å.',
        'Ïù¥Í±¥ 24ÏãúÍ∞Ñ Îí§Ïóê Îã§Ïãú Î≥¥Î©¥ ÏßÑÏßú ÌïÑÏöîÌïúÏßÄ Ïïå Ïàò ÏûàÏñ¥.',
        'Ïù¥Î≤à Ï£ºÎäî ÏßÄÏ∂ú ÎåÄÏã† ‚ÄúÍ∏∞Î∂Ñ ÌöåÎ≥µ‚ÄùÏùÑ Îèà Ïïà ÎìúÎäî Î∞©ÏãùÏúºÎ°ú ÌïòÏûê.'
      ]
    },
    work: {
      metrics: ['Ïö∞ÏÑ†ÏàúÏúÑ ÏÑ†Î™ÖÎèÑ', 'ÌòëÏóÖ ÎßàÏ∞∞ ÎπÑÏö©', 'Ïã§Ìñâ ÏßÄÏÜçÎ†•'],
      goodMoves: [
        'Ïò§Îäò Î™©ÌëúÎ•º ‚Äú3Ï§Ñ(Î™©Ìëú/ÏÇ∞Ï∂úÎ¨º/ÎßàÍ∞ê)‚ÄùÎ°ú Ï™ºÍ∞úÍ∏∞',
        'ÌöåÏùòÎäî ‚ÄúÍ≤∞Ï†ï/Îã¥Îãπ/Í∏∞Ìïú‚Äù 3Í∞úÎßå ÎÇ®Í∏∞Í≥† ÎÅùÎÇ¥Í∏∞',
        'Ï∞©Ïàò Ïû•Î≤ΩÏùÑ 5Î∂ÑÏúºÎ°ú Ï§ÑÏù¥Îäî ‚ÄúÏ≤´ ÌñâÎèô‚Äù Ï†ïÏùò'
      ],
      recovery: [
        'ÏóÖÎ¨¥Î•º ‚ÄúÏßÄÍ∏à/Ïù¥Î≤à Ï£º/ÎÇòÏ§ë‚ÄùÏúºÎ°ú Ïû¨Î∂ÑÎ•ò',
        'ÎßâÌûàÎ©¥ ÏßàÎ¨∏ÏùÑ ‚ÄúÏòà/ÏïÑÎãàÏò§‚ÄùÎ°ú ÎãµÌï† Ïàò ÏûàÍ≤å Ï¢ÅÌûàÍ∏∞',
        'ÏôÑÎ≤Ω Í∏∞Ï§ÄÏùÑ ÎÇÆÏ∂îÍ≥† ‚ÄúÏ¥àÏïà‚ÜíÌîºÎìúÎ∞±‚Äù Î£®ÌîÑÎ°ú Ï†ÑÌôò'
      ],
      scripts: [
        'Ïù¥Î≤à Í±¥Ïùò ÏôÑÎ£å Í∏∞Ï§ÄÏùÄ (A)Ïù¥Í≥†, (B)Îäî Îã§Ïùå Îã®Í≥ÑÎ°ú ÎØ∏Î§ÑÎèÑ Îê†ÍπåÏöî?',
        'Ï†úÍ∞Ä Ïò§Îäò ÎÇº Ïàò ÏûàÎäî ÏÇ∞Ï∂úÎ¨ºÏùÄ (X)Ïù¥Í≥†, Í∏∞ÌïúÏùÄ (Y)ÏûÖÎãàÎã§.',
        'Ïù¥Í±¥ ÏßÄÍ∏à Í≤∞Ï†ïÏù¥ ÌïÑÏöîÌï¥Ïöî? ÏïÑÎãàÎ©¥ Ï†ïÎ≥¥Îßå Í≥µÏú†ÌïòÎ©¥ ÎêòÎÇòÏöî?'
      ]
    },
    wellbeing: {
      metrics: ['ÏàòÎ©¥/Ïª®ÎîîÏÖò', 'ÌöåÎ≥µ Î£®Ìã¥', 'Ïä§Ìä∏Î†àÏä§ Ïã†Ìò∏ Ïù∏ÏßÄ'],
      goodMoves: [
        'Ïª®ÎîîÏÖòÏùÑ 10Ï†ê ÎßåÏ†êÏúºÎ°ú Îß§Ïùº Í∏∞Î°ù(3Ï¥à)',
        'Ïπ¥ÌéòÏù∏/ÏïºÏãù/Ïä§ÌÅ¨Î¶∞ ÏãúÍ∞ÑÏùÑ ‚ÄúÌïòÎÇòÎßå‚Äù Ï§ÑÏù¥Í∏∞',
        'ÏßßÏùÄ ÏÇ∞Ï±Ö 10Î∂ÑÏúºÎ°ú Î¶¨ÏÖã Ìä∏Î¶¨Í±∞ ÎßåÎì§Í∏∞'
      ],
      recovery: [
        'Ïò§ÎäòÏùÄ ‚ÄúÏú†ÏßÄ Î™®Îìú‚Äù: ÏµúÏÜå Î£®Ìã¥Îßå ÏàòÌñâÌïòÍ≥† Îπ®Î¶¨ ÎßàÎ¨¥Î¶¨',
        'Î™∏ Ïã†Ìò∏(Ïñ¥Íπ®/ÌÑ±/Ìò∏Ìù°) 1Í∞úÎ•º Í∏∞Ï§ÄÏúºÎ°ú Í≥ºÎ∂ÄÌïò Í∞êÏßÄ',
        'ÎÇ¥ÏùºÏùò ÎÇòÎ•º ÏúÑÌï¥ ÏàòÎ©¥ Î®ºÏ†Ä ÌôïÎ≥¥'
      ],
      scripts: [
        'Ïò§ÎäòÏùÄ Ïª®ÎîîÏÖòÏù¥ ÎÇÆÏïÑÏÑú ÏµúÏÜå Î£®Ìã¥Îßå ÌïòÍ≥† Ïâ¨Í≤†ÏäµÎãàÎã§.',
        'ÏßÄÍ∏à Í≥ºÎ∂ÄÌïò Ïã†Ìò∏Í∞Ä ÏôÄÏÑú Ïû†Íπê Î¶¨ÏÖãÏù¥ ÌïÑÏöîÌï¥Ïöî.',
        'ÎÇ¥Ïùº Ïª®ÎîîÏÖòÏùÑ ÏúÑÌï¥ Ïò§ÎäòÏùÄ Ïó¨Í∏∞ÍπåÏßÄ ÌïòÍ≤†ÏäµÎãàÎã§.'
      ]
    },
    lifestyle: {
      metrics: ['ÏÑ†ÌÉù Í∏∞Ï§ÄÏùò ÏùºÍ¥ÄÏÑ±', 'ÎßåÏ°± Ïû¨ÌòÑÏÑ±', 'ÌîºÎ°ú Í¥ÄÎ¶¨'],
      goodMoves: [
        'ÏÑ†ÌÉù Í∏∞Ï§ÄÏùÑ 2Í∞úÎßå Í≥†Ï†ï(Ïòà: Í∞ÄÏÑ±ÎπÑ+Ìé∏ÏïàÌï®)',
        'Î¶¨Ïä§Ìä∏Î•º ‚ÄúÌïÑÏàò 3Í∞ú + ÏòµÏÖò‚ÄùÏúºÎ°ú ÎÇòÎà† Í≥ºÎ∂ÄÌïò Ï§ÑÏù¥Í∏∞',
        'ÌõÑÌöå Ìè¨Ïù∏Ìä∏Î•º Í∏∞Î°ùÌï¥ Îã§Ïùå ÏÑ†ÌÉùÏóê Î∞òÏòÅ'
      ],
      recovery: [
        'Í∏∞Ï§ÄÏù¥ ÌùîÎì§Î¶¥ Îïê ‚ÄúÌïòÎÇòÎßå ÌôïÏã§Ìûà‚Äù Ï†ÑÎûµÏúºÎ°ú Ï†ÑÌôò',
        'ÏÑ†ÌÉùÏùÑ ÎØ∏Î£®Í∏∞Î≥¥Îã§ ‚ÄúÏ∂©Î∂ÑÌûà Ï¢ãÏùÄ‚Äù ÏÑ†ÌÉùÏùÑ Îπ†Î•¥Í≤å ÌôïÏ†ï',
        'ÌîºÎ°úÍ∞Ä ÎàÑÏ†ÅÎêòÎ©¥ ÎßåÏ°±ÎèÑÎäî ÎÇ¥Î†§Í∞ÄÎãà Ìú¥Ïãù Î®ºÏ†Ä'
      ],
      scripts: [
        'Ïù¥Î≤à ÏÑ†ÌÉùÏùÄ (Í∏∞Ï§Ä1)/(Í∏∞Ï§Ä2) Îëê Í∞ÄÏßÄÎßå Î≥¥Í≥† Í≤∞Ï†ïÌï†Í≤å.',
        'ÏòµÏÖòÏùÄ Ï¢ãÏïÑÎèÑ Ïò§ÎäòÏùÄ ‚ÄúÌïÑÏàò 3Í∞ú‚ÄùÎßå Ï±ôÍ∏∞Ïûê.',
        'Ï∂©Î∂ÑÌûà Ï¢ãÏùÄ ÏÑ†ÌÉùÏù¥Î©¥ ÏßÄÍ∏à ÌôïÏ†ïÌïòÍ≥† Ï¶êÍ∏∞Ïûê.'
      ]
    },
    general: {
      metrics: ['ÏÑ†ÌÉù-Ïã§Ìñâ Ïó∞Í≤∞', 'Î¶¨Îì¨ Ïú†ÏßÄ', 'ÌöåÎ≥µ ÏÜçÎèÑ'],
      goodMoves: [
        'Î™©ÌëúÎ•º ‚ÄúÏûëÍ≤å ÏãúÏûëÌï¥ ÌÅ¨Í≤å ÎäòÎ¶¨Í∏∞‚ÄùÎ°ú ÏÑ§Í≥Ñ',
        'ÏßÄÍ∏à ÌïÑÏöîÌïú Ï†ïÎ≥¥ 1Í∞úÎßå ÏàòÏßëÌïòÍ≥† Ïã§Ìñâ',
        'ÎÅùÎÇ¥Îäî ÏäµÍ¥Ä(ÎßàÍ∞ê)Î∂ÄÌÑ∞ ÎßåÎì§Í∏∞'
      ],
      recovery: [
        'Ïö∞ÏÑ†ÏàúÏúÑÎ•º 1Í∞úÎ°ú Ï§ÑÏù¥Í≥† Ï∞©ÏàòÎ∂ÄÌÑ∞',
        'Í≥ºÎ∂ÄÌïò Ïã†Ìò∏Í∞Ä Ïò§Î©¥ ÏÜçÎèÑÎ•º ÎÇÆÏ∂îÍ≥† Ïú†ÏßÄ',
        'ÎÇ¥Ïùº Îã§Ïãú Ìï† Ïàò ÏûàÍ≤å ÏóêÎÑàÏßÄ Í¥ÄÎ¶¨'
      ],
      scripts: [
        'ÏßÄÍ∏àÏùÄ Ìïú Í∞ÄÏßÄÎßå Î®ºÏ†Ä ÌïòÍ≥†, ÎÇòÎ®∏ÏßÄÎäî Îã§ÏùåÏúºÎ°ú ÎÑòÍ∏∞Ïûê.',
        'ÏùºÎã® 5Î∂ÑÎßå ÏãúÏûëÌï¥Î≥¥Ïûê. Ïã´ÏúºÎ©¥ Í∑∏ÎßåÌï¥ÎèÑ Îèº.',
        'ÏôÑÎ≤Ω ÎßêÍ≥† ‚ÄúÏôÑÎ£å‚ÄùÎ•º Î™©ÌëúÎ°ú ÌïòÏûê.'
      ]
    }
  };
  const pb = PLAYBOOKS[category] || PLAYBOOKS.general;

  // ---------- archetype inference (Í≤∞Í≥ºÎ≥Ñ ÎäêÎÇå Ï∞®Ïù¥Î•º ÎßåÎìúÎäî ÌïµÏã¨) ----------
  const ARCHETYPES = [
    { key:'planner', name:'ÏÑ§Í≥ÑÌòï', tone:'Íµ¨Ï°∞ÏôÄ Í∏∞Ï§Ä', strengths:['Íµ¨Ï°∞Ìôî', 'Ïö∞ÏÑ†ÏàúÏúÑ', 'Î¶¨Ïä§ÌÅ¨ Í¥ÄÎ¶¨'], pitfalls:['Í≥ºÏûâ Í≥ÑÌöç', 'Ïã§Ìñâ ÏßÄÏó∞'], routines:['Ï∞©Ïàò Í∏∞Ï§ÄÏùÑ 1Î¨∏Ïû•ÏúºÎ°ú Ï†ïÌïòÍ∏∞', 'ÏôÑÎ£å Ï†ïÏùò(DoD) Î®ºÏ†Ä Ï†ÅÍ∏∞'] },
    { key:'explorer', name:'ÌÉêÌóòÌòï', tone:'ÏÉàÎ°úÏõÄÍ≥º Í≤ΩÌóò', strengths:['Í∏∞Ìöå Ìè¨Ï∞©', 'Ïú†Ïó∞Ìïú Ï†ÑÌôò', 'Î™∞ÏûÖ'], pitfalls:['Ï∂©Îèô ÏÑ†ÌÉù', 'ÎßàÎ¨¥Î¶¨ ÏïΩÌï®'], routines:['ÏÑ†ÌÉù Í∏∞Ï§Ä 2Í∞úÎßå Í≥†Ï†ï', 'ÎßàÍ∞ê 10Î∂Ñ Ï†ÑÏóê Ï†ïÎ¶¨'] },
    { key:'empath', name:'Í≥µÍ∞êÌòï', tone:'Í¥ÄÍ≥ÑÏôÄ Î∂ÑÏúÑÍ∏∞', strengths:['Í≥µÍ∞ê', 'Î∞∞Î†§', 'Ï°∞Ïú®'], pitfalls:['ÎààÏπò Í≥ºÎã§', 'Í≤ΩÍ≥Ñ ÌùêÎ¶º'], routines:['ÎÇ¥ Í∏∞Ï§ÄÏùÑ Î®ºÏ†Ä ÎßêÌïòÍ∏∞', 'ÏöîÏ≤≠ÏùÑ Ìïú Î¨∏Ïû•ÏúºÎ°ú Íµ¨Ï≤¥Ìôî'] },
    { key:'analyst', name:'Î∂ÑÏÑùÌòï', tone:'Í∑ºÍ±∞ÏôÄ Ìï©Î¶¨ÏÑ±', strengths:['Î∂ÑÏÑù', 'Í≤ÄÏ¶ù', 'Ï†ïÌôïÎèÑ'], pitfalls:['Í≥ºÎèÑÌïú ÎπÑÍµê', 'Î∂àÏïà ÌöåÌîº'], routines:['Ï†ïÎ≥¥ ÏàòÏßë ÏãúÍ∞ÑÏùÑ Ï†úÌïú', 'Í≤∞Ï†ï ÏãúÏ†ê(Îç∞ÎìúÎùºÏù∏) ÏÑ§Ï†ï'] },
    { key:'driver', name:'Ï∂îÏßÑÌòï', tone:'ÏÜçÎèÑÏôÄ ÏÑ±Í≥º', strengths:['Í≤∞Îã®', 'Ïã§Ìñâ', 'Ï£ºÎèÑ'], pitfalls:['Í≥ºÏó¥', 'ÌîºÎ°ú ÎàÑÏ†Å'], routines:['ÏÜçÎèÑ Ï°∞Ï†à(ÌéòÏù¥Ïä§) Í∑úÏπô', 'Ï§ëÍ∞Ñ Ï†êÍ≤Ä ÌÉÄÏûÑÎ∞ïÏä§'] },
    { key:'stabilizer', name:'ÏïàÏ†ïÌòï', tone:'ÏßÄÏÜçÍ≥º Í∑†Ìòï', strengths:['Íæ∏Ï§ÄÌï®', 'ÏïàÏ†ïÍ∞ê', 'Ïã†Ï§ëÌï®'], pitfalls:['Î≥ÄÌôî ÌöåÌîº', 'Í≤∞Ï†ï ÏßÄÏó∞'], routines:['ÏûëÍ≤å Ïã§ÌóòÌïòÍ∏∞', 'Î≥ÄÍ≤ΩÏùÑ 1Í∞úÎßå ÌóàÏö©'] }
  ];

  const inferArchetype = () => {
    const hay = `${resultTitle} ${strengths.join(' ')} ${pitfalls.join(' ')}`.toLowerCase();
    const has = (kw) => hay.includes(kw);
    const score = (a) => a.key === 'planner' ? ['Í≥ÑÌöç','Ï†ÑÎûµ','Î£®Ìã¥','Ï†ïÎ¶¨','Í¥ÄÎ¶¨','Ï≤¥Í≥Ñ'].filter(has).length
                     : a.key === 'explorer' ? ['Ï¶âÌù•','ÏûêÏú†','Í∞êÍ∞Å','Î™®Ìóò','ÎèÑÏ†Ñ','ÏÉàÎ°ú'].filter(has).length
                     : a.key === 'empath' ? ['Í∞êÏÑ±','Í≥µÍ∞ê','Î∞∞Î†§','Í¥ÄÍ≥Ñ','Îî∞Îúª','ÎààÏπò'].filter(has).length
                     : a.key === 'analyst' ? ['Î∂ÑÏÑù','ÎÖºÎ¶¨','Ìå©Ìä∏','Îç∞Ïù¥ÌÑ∞','Ïù¥ÏÑ±','Í≤ÄÏ¶ù'].filter(has).length
                     : a.key === 'driver' ? ['Î¶¨Îçî','Ï£ºÎèÑ','Í≤∞Îã®','ÏÜçÎèÑ','ÏßÅÏßÑ','ÏÑ±Í≥º'].filter(has).length
                     : ['ÏïàÏ†ï','Ïã†Ï§ë','Íæ∏Ï§Ä','Ï∞®Î∂Ñ','Í∑†Ìòï','Î≥¥Ïàò'].filter(has).length;

    const scored = ARCHETYPES.map(a => ({a, s: score(a)})).sort((x,y) => y.s - x.s);
    if (scored[0].s > 0) return scored[0].a;
    // ÌÇ§ÏõåÎìú Îß§Ïπ≠Ïù¥ ÏóÜÏúºÎ©¥ draft Í∏∞Î∞ò ÎûúÎç§(ÌïòÏßÄÎßå Í≥†Ï†ïÎê®)
    return pick(ARCHETYPES, ARCHETYPES[0]);
  };

  const archetype = inferArchetype();

  const summaryTemplates = [
    `${resultTitle} ÌÉÄÏûÖÏùÄ ${profile.focus}ÏóêÏÑú "${archetype.tone}"ÏùÑ(Î•º) Í∏∞Ï§ÄÏúºÎ°ú ÌåêÎã®Ìï† Îïå ${profile.outcome}Ïù¥ ÎÜíÏïÑÏßëÎãàÎã§.`,
    `${profile.context}Í∞Ä Î≥µÏû°Ìï¥ÏßàÏàòÎ°ù ${resultTitle} ÌÉÄÏûÖÏùÄ "${pick(archetype.strengths)}"ÏúºÎ°ú(Î°ú) ÌùêÎ¶ÑÏùÑ Ï†ïÎ¶¨Ìï¥ ${profile.outcome}ÏùÑ Ïò¨Î¶¨Îäî Í≤ΩÌñ•Ïù¥ ÏûàÏäµÎãàÎã§.`,
    `${resultTitle} ÌÉÄÏûÖÏùÄ ${profile.focus} ÏÑ†ÌÉùÏóêÏÑú "${pick(archetype.strengths)}"Ïù¥(Í∞Ä) ÌïµÏã¨ Î†àÎ≤ÑÏûÖÎãàÎã§. Ïù¥ Î†àÎ≤ÑÎ•º Ïûò Ïì∞Î©¥ ÎßåÏ°±ÎèÑÍ∞Ä ÏïàÏ†ïÏ†ÅÏúºÎ°ú Ïû¨ÌòÑÎê©ÎãàÎã§.`
  ];

  const fallbackStrength = () => pick(archetype.strengths, 'ÏÉÅÌô© ÌååÏïÖ');
  const fallbackPitfall = () => pick(archetype.pitfalls, 'Ïö∞ÏÑ†ÏàúÏúÑ ÌòºÏÑ†');
  const fallbackRoutine = () => pick(archetype.routines, 'ÌïµÏã¨ 1Í∞ÄÏßÄÎßå Î®ºÏ†Ä ÌïòÍ∏∞');

  const leadStrength = strengths[0] || fallbackStrength();
  const supportStrength = strengths[1] || pick([...archetype.strengths, ...pb.metrics], fallbackStrength());
  const leadPitfall = pitfalls[0] || fallbackPitfall();
  const supportPitfall = pitfalls[1] || pick([...archetype.pitfalls], fallbackPitfall());
  const leadRoutine = routine[0] || fallbackRoutine();
  const supportRoutine = routine[1] || pick([...pb.goodMoves, ...pb.recovery], fallbackRoutine());

  const buildGeneratedSections = () => {
    const sections = [];
    const summary = data.desc || pick(summaryTemplates, `${resultTitle} ÌÉÄÏûÖÏùÄ ${profile.focus}ÏóêÏÑú Í∑†Ìòï Ïû°Ìûå Ïã§Ìñâ ÌùêÎ¶ÑÏùÑ Î≥¥ÏûÖÎãàÎã§.`);
    const kws = uniq([...keywords, leadStrength, archetype.name, profile.focus]).slice(0, 4);

    sections.push({
      title: '1) ÌïµÏã¨ ÏöîÏïΩ',
      bullets: [
        summary,
        `ÌÇ§ÏõåÎìú: ${kws.join(' ¬∑ ')}`,
        `Ïù¥Î≤à Î¶¨Ìè¨Ìä∏Îäî "${profile.context}" ÏÉÅÌô©ÏóêÏÑú "${profile.outcome}"ÏùÑ ÎÜíÏù¥Îäî Ïã§Ï†Ñ Ìè¨Ïù∏Ìä∏Î•º Ï§ëÏã¨ÏúºÎ°ú Íµ¨ÏÑ±ÌñàÏäµÎãàÎã§.`
      ]
    });

    sections.push({
      title: '2) Í∞ïÏ†êÏù¥ ÏûëÎèôÌïòÎäî Î∞©Ïãù',
      bullets: [
        `Ï£ºÍ∞ïÏ†ê: "${leadStrength}" ‚Äî ${profile.context}Í∞Ä Î≥µÏû°Ìï¥ÎèÑ ÌïµÏã¨ÏùÑ Ïû°ÏïÑ ${profile.outcome}ÏùÑ ÎÅåÏñ¥Ïò¨Î¶ΩÎãàÎã§.`,
        `Î≥¥Í∞ïÏ†ê: "${supportStrength}" ‚Äî Ï£ºÍ∞ïÏ†êÏù¥ ÌùîÎì§Î¶¥ Îïå ÌùêÎ¶ÑÏùÑ Îã§Ïãú Ï†ïÎ†¨Ìï¥ Ï£ºÎäî Ïó≠Ìï†ÏùÑ Ìï©ÎãàÎã§.`,
        `Ïûò ÌíÄÎ¶¨Îäî Ï°∞Í±¥: ${pick(pb.metrics)}Í∞Ä ÏïàÏ†ïÏ†ÅÏùºÏàòÎ°ù ÏÑ±Í≥º/ÎßåÏ°±Ïùò Ïû¨ÌòÑÏÑ±Ïù¥ Ïò¨ÎùºÍ∞ëÎãàÎã§.`
      ]
    });

    sections.push({
      title: '3) ÌùîÎì§Î¶¨Îäî ÏßÄÏ†ê(Ìä∏Î¶¨Í±∞)Í≥º Ïã†Ìò∏',
      bullets: [
        `Ï£ºÏùò Ïã†Ìò∏ ‚ë†: "${leadPitfall}" ‚Äî ÏÑ†ÌÉùÏù¥ Îπ®ÎùºÏßÄÎäî ÎåÄÏã†, Ï§ëÌõÑÎ∞ò ÌéòÏù¥Ïä§ Í¥ÄÎ¶¨Í∞Ä ÏïΩÌï¥Ïßà Ïàò ÏûàÏäµÎãàÎã§.`,
        `Ï£ºÏùò Ïã†Ìò∏ ‚ë°: "${supportPitfall}" ‚Äî Í∏∞Ï§ÄÏù¥ ÎßéÏïÑÏßÄÎ©¥ Ïã§ÌñâÏù¥ ÎÅäÍ∏∞Í±∞ÎÇò Í≥ºÎ∂ÄÌïòÎ°ú Ïù¥Ïñ¥Ïßà Ïàò ÏûàÏäµÎãàÎã§.`,
        `ÌöåÎ≥µ Ïä§ÏúÑÏπò: ${pick(pb.recovery)}`
      ]
    });

    // Starter: ÏßßÍ≥† Ïã§Ï†ÑÏ†ÅÏù∏ Î£®Ìã¥(3~5Í∞ú)
    const starterPlan = [
      `D1(Ï∞©Ïàò): "${leadRoutine}" ‚Äî ÏãúÏûëÏùÑ 5Î∂Ñ ÏïàÏóê ÎÅùÎÇ¥Îäî ‚ÄòÏ≤´ ÌñâÎèô‚ÄôÏùÑ Ï†ïÌï©ÎãàÎã§.`,
      `D2(Ï†ïÎ†¨): "${supportRoutine}" ‚Äî Í∏∞Ï§ÄÏùÑ 2Í∞úÎßå ÎÇ®Í∏∞Í≥† ÎÇòÎ®∏ÏßÄÎäî ÏòµÏÖòÏúºÎ°ú Î∞ÄÏñ¥Îë°ÎãàÎã§.`,
      `D3(ÎßàÍ∞ê): ÎßàÍ∞ê 10Î∂Ñ Ï†ÑÏóê ‚ÄúÏûòÌïú 1Í∞ú/Í≥†Ïπ† 1Í∞ú‚ÄùÎßå Í∏∞Î°ùÌï©ÎãàÎã§.`,
      `Î≥¥ÎÑàÏä§: ${pick(pb.goodMoves)}`
    ];

    sections.push({
      title: plan === 'full' ? '4) 7Ïùº Ïã§Ï≤ú ÌîåÎûú(Starter Ìè¨Ìï®)' : '4) 3Ïùº Î¶¨ÏÖã Î£®Ìã¥',
      bullets: plan === 'full'
        ? [
            starterPlan[0],
            starterPlan[1],
            starterPlan[2],
            `D4~D7(Ïú†ÏßÄ): ${pick(pb.goodMoves)}Î•º Ï£º 3Ìöå Î∞òÎ≥µÌï¥ Ìå®ÌÑ¥ÏùÑ Í≥†Ï†ïÌï©ÎãàÎã§.`,
            `Ï∏°Ï†ï Ìè¨Ïù∏Ìä∏: ${pick(pb.metrics)}Î•º 10Ï†ê ÎßåÏ†êÏúºÎ°ú Í∏∞Î°ùÌïòÎ©¥ Î≥ÄÌôîÍ∞Ä ÎààÏóê Î≥¥ÏûÖÎãàÎã§.`
          ]
        : starterPlan
    });

    const goodScenario = pick([
      `${profile.focus} ÏÑ†ÌÉùÏù¥ ÌïÑÏöîÌïú ÏàúÍ∞Ñ, "${leadStrength}"Î°ú Îπ†Î•¥Í≤å Î∞©Ìñ•ÏùÑ Ïû°Í≥† Ïã§ÌñâÏúºÎ°ú Ïó∞Í≤∞Ìï©ÎãàÎã§.`,
      `${profile.context}Í∞Ä Ï†ïÎ¶¨ÎêòÏñ¥ ÏûàÏùÑ Îïå, "${supportStrength}" ÎçïÎ∂ÑÏóê ÎßåÏ°±ÎèÑÍ∞Ä ÏïàÏ†ïÏ†ÅÏúºÎ°ú Ïû¨ÌòÑÎê©ÎãàÎã§.`,
      `Í∏∞Ï§ÄÏù¥ Î™ÖÌôïÌï† Îïå, "${leadStrength}"Í∞Ä ÎπõÎÇòÎ©∞ ${profile.outcome}Ïù¥ ÌÅ¨Í≤å Ïò¨ÎùºÍ∞ëÎãàÎã§.`
    ]);

    const wobbleScenario = pick([
      `${profile.context}Í∞Ä Î≥µÏû°Ìï¥ÏßÄÎ©¥ "${leadPitfall}"Ïù¥ ÎÇòÌÉÄÎÇ† Ïàò ÏûàÏäµÎãàÎã§. Ïù¥ÎïåÎäî ÏÑ†ÌÉù Î≤îÏúÑÎ•º Ï§ÑÏù¥Í≥† "${leadRoutine}"Îßå Î®ºÏ†Ä Ïã§ÌñâÌïòÏÑ∏Ïöî.`,
      `ÌîºÎ°úÍ∞Ä ÎàÑÏ†ÅÎêòÎ©¥ "${supportPitfall}"Ïù¥ Í≤πÏ≥ê ÌùêÎ¶ÑÏù¥ ÎÅäÍ∏∞Í∏∞ ÏâΩÏäµÎãàÎã§. ‚ÄúÏú†ÏßÄ Î™®Îìú(ÏµúÏÜå Î£®Ìã¥)‚ÄùÎ°ú Ï†ÑÌôòÌïòÎ©¥ ÌöåÎ≥µÏù¥ Îπ†Î¶ÖÎãàÎã§.`,
      `Ïô∏Î∂Ä Î≥ÄÏàò(ÏãúÍ∞Ñ/ÏòàÏÇ∞/Í¥ÄÍ≥Ñ)Í∞Ä ÎäòÏñ¥ÎÇ†ÏàòÎ°ù Ïö∞ÏÑ†ÏàúÏúÑÍ∞Ä ÌùîÎì§Î¶ΩÎãàÎã§. Í∏∞Ï§ÄÏùÑ 2Í∞úÎ°ú Í≥†Ï†ïÌïòÎ©¥ Î≥µÍµ¨Í∞Ä Ïâ¨ÏõåÏßëÎãàÎã§.`
    ]);

    sections.push({
      title: '5) ÏÉÅÌô© ÏòàÏãú(Ïûò Îê† Îïå vs ÌùîÎì§Î¶¥ Îïå)',
      bullets: [
        `Ïûò Îê† Îïå: ${goodScenario}`,
        `ÌùîÎì§Î¶¥ Îïå: ${wobbleScenario}`,
        `Î∞îÎ°ú Ïì∞Îäî Ìïú Î¨∏Ïû•: "${pick(pb.scripts)}"`
      ]
    });

    // Full Ï†ÑÏö©: Îçî ÍπäÏùÄ Í∞úÏù∏Ìôî + ÎåÄÎ≥∏ + 30Ïùº ÌîåÎûú + Í∂ÅÌï©
    if (plan === 'full') {
      const motive = pick([
        `${profile.focus}ÏóêÏÑú Í∞ÄÏû• Ï§ëÏöîÌïòÍ≤å Ïó¨Í∏∞Îäî Í≤ÉÏùÄ ‚Äú${pick(pb.metrics)}‚ÄùÏûÖÎãàÎã§.`,
        `ÎãπÏã†Ïùò ÎßåÏ°±ÏùÄ ‚Äú${profile.outcome}‚ÄùÏù¥(Í∞Ä) ÎààÏóê Î≥¥Ïùº Îïå Ïª§ÏßëÎãàÎã§.`,
        `ÏÑ†ÌÉùÏùò Í∏∞Ï§ÄÏù¥ ÌùîÎì§Î¶¨Î©¥ Ïä§Ìä∏Î†àÏä§Í∞Ä Ïò¨ÎùºÍ∞ÄÎØÄÎ°ú, Í∏∞Ï§ÄÏùÑ ‚ÄòÎ¨∏Ïû•‚ÄôÏúºÎ°ú Í≥†Ï†ïÌïòÎäî Í≤ÉÏù¥ ÎèÑÏõÄÎê©ÎãàÎã§.`
      ]);

      sections.push({
        title: '6) Ïã¨Ï∏µ Î∂ÑÏÑù(ÎèôÍ∏∞/ÏöïÍµ¨/Î∞©Ïñ¥ Ìå®ÌÑ¥)',
        bullets: [
          motive,
          `Ïä§Ìä∏Î†àÏä§Í∞Ä ÎÜíÏùÑ Îïå ÎÇòÌÉÄÎÇòÎäî Ìå®ÌÑ¥: "${leadPitfall}" ‚Üí "${supportPitfall}" ÏàúÏúºÎ°ú ÌôïÎ•†Ïù¥ Ïò¨ÎùºÍ∞ëÎãàÎã§.`,
          `ÏÑ±Ïû• Î†àÎ≤Ñ: "${leadStrength}"Î•º Ïú†ÏßÄÌïòÎêò, "${pick(pb.recovery)}"Î°ú ÌéòÏù¥Ïä§Î•º Ï°∞Ï†àÌïòÎ©¥ Ïû•Í∏∞ ÏÑ±Í≥ºÍ∞Ä Ïª§ÏßëÎãàÎã§.`
        ]
      });

      const preferredType = strengths[0] ? `${strengths[0]}ÏùÑ(Î•º) Ïûò ÏÇ¥Î†§Ï£ºÎäî ÌÉÄÏûÖ` : `${archetype.name}Í≥º(ÏôÄ) Î¶¨Îì¨Ïù¥ ÎπÑÏä∑Ìïú ÌÉÄÏûÖ`;
      const frictionType = pitfalls[0] ? `"${pitfalls[0]}"ÏùÑ(Î•º) ÏûêÏ£º ÏûêÍ∑πÌïòÎäî ÌÉÄÏûÖ` : `ÏÜçÎèÑ/Í∏∞Ï§ÄÏù¥ ÎÑàÎ¨¥ Îã§Î•∏ ÌÉÄÏûÖ`;

      sections.push({
        title: '7) Í∂ÅÌï©/ÌòëÏóÖ ÏßÄÎèÑ(ÏÇ¨Îûå¬∑ÌôòÍ≤Ω)',
        bullets: [
          `Ïûò ÎßûÎäî Ï™Ω: ${preferredType} ‚Äî Í∏∞Ï§ÄÏùÑ Î™ÖÌôïÌûà Ï£ºÍ±∞ÎÇò Ïã§ÌñâÏùÑ ÎèÑÏôÄÏ£ºÎäî ÌôòÍ≤ΩÏóêÏÑú Í∞ïÏ†êÏù¥ Í∑πÎåÄÌôîÎê©ÎãàÎã§.`,
          `ÎßàÏ∞∞Ïù¥ ÏÉùÍ∏∞Í∏∞ Ïâ¨Ïö¥ Ï™Ω: ${frictionType} ‚Äî Ïù¥ÎïåÎäî ‚ÄúÍ∏∞Ï§Ä 1Í∞ú + ÏöîÏ≤≠ 1Í∞ú‚ÄùÎ°ú ÎåÄÌôîÎ•º Îã®ÏàúÌôîÌïòÏÑ∏Ïöî.`,
          `Ï∂îÏ≤ú ÎåÄÎ≥∏: "${pick(pb.scripts)}"`
        ]
      });

      sections.push({
        title: '8) 30Ïùº ÏóÖÍ∑∏Î†àÏù¥Îìú ÌîåÎûú',
        bullets: [
          `1Ï£ºÏ∞®: Í∏∞Ï§Ä ÎßåÎì§Í∏∞ ‚Äî ${pick(pb.goodMoves)}`,
          `2Ï£ºÏ∞®: Î∞òÎ≥µ ÎßåÎì§Í∏∞ ‚Äî ${pick(pb.goodMoves)}`,
          `3Ï£ºÏ∞®: ÌöåÎ≥µ Ïû•Ïπò ‚Äî ${pick(pb.recovery)}`,
          `4Ï£ºÏ∞®: Ïû¨ÌòÑÏÑ± Í∞ïÌôî ‚Äî ${pick(pb.metrics)}Î•º Í∏∞Î°ùÌïòÍ≥† ‚ÄòÏûò Îêú Ï°∞Í±¥‚ÄôÏùÑ Í≥†Ï†ïÌï©ÎãàÎã§.`
        ]
      });

      sections.push({
        title: '9) ÏÉÅÌô©Î≥Ñ Î¨∏Ïû•/ÎåÄÎ≥∏ 5Í∞ú',
        bullets: uniq([
          pick(pb.scripts),
          pick(pb.scripts),
          pick(pb.scripts),
          `ÏßÄÍ∏àÏùÄ Í≥ºÎ∂ÄÌïòÎùºÏÑú Î≤îÏúÑÎ•º Ï§ÑÏù¥Í≥† ÌïµÏã¨Îßå ÌïòÍ≤†ÏäµÎãàÎã§.`,
          `ÏôÑÎ£å Í∏∞Ï§ÄÏùÑ Î®ºÏ†Ä ÎßûÏ∂ò Îã§Ïùå, ÎîîÌÖåÏùºÏùÄ Îã§Ïùå Îã®Í≥ÑÎ°ú ÎÑòÍ∏∞Í≤†ÏäµÎãàÎã§.`
        ]).slice(0, 5)
      });

      sections.push({
        title: '10) Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏(Ïã§Ï†ÑÏö©)',
        bullets: [
          'Í∏∞Ï§ÄÏùÄ 2Í∞úÎßå ÎÇ®Í≤ºÎäîÍ∞Ä?',
          'Ï≤´ ÌñâÎèôÏù¥ 5Î∂Ñ ÏïàÏóê Í∞ÄÎä•ÌïúÍ∞Ä?',
          'Ïò§ÎäòÏùò ‚ÄúÏôÑÎ£å Ï†ïÏùò(DoD)‚ÄùÍ∞Ä Ï†ÅÌòÄ ÏûàÎäîÍ∞Ä?',
          'ÌîºÎ°ú/Í≥ºÎ∂ÄÌïò Ïã†Ìò∏Î•º Ïù∏ÏßÄÌñàÎäîÍ∞Ä?',
          'ÎåÄÌôîÎäî ‚ÄúÏÇ¨Ïã§+ÎäêÎÇå+ÏöîÏ≤≠‚ÄùÏúºÎ°ú ÎßêÌñàÎäîÍ∞Ä?',
          'Í∏∞Î°ùÏùÄ ‚ÄúÏûòÌïú 1Í∞ú/Í≥†Ïπ† 1Í∞ú‚ÄùÎßå ÌñàÎäîÍ∞Ä?',
          'ÎÇ¥ÏùºÏùÑ ÏúÑÌï¥ ÏóêÎÑàÏßÄÎ•º ÎÇ®Í≤ºÎäîÍ∞Ä?'
        ]
      });
    }

    sections.push({
      title: 'ÏïàÎÇ¥',
      bullets: [
        'Î≥∏ Î¶¨Ìè¨Ìä∏Îäî Ïû¨ÎØ∏ÏôÄ ÏûêÍ∏∞Ïù¥Ìï¥Î•º ÏúÑÌïú Ï∞∏Í≥† ÏûêÎ£åÏù¥Î©∞, ÏùòÌïôÏ†Å/Ïã¨Î¶¨ÌïôÏ†Å ÏßÑÎã®Ïù¥ÎÇò ÏπòÎ£åÎ•º ÎåÄÏ≤¥ÌïòÏßÄ ÏïäÏäµÎãàÎã§.',
        'Ïò§ÎäòÏùò ÏÉÅÌÉú(ÏàòÎ©¥, Ïä§Ìä∏Î†àÏä§, ÏùºÏ†ï)Ïóê Îî∞Îùº Í≤∞Í≥º Ï≤¥Í∞êÏù¥ Îã¨ÎùºÏßà Ïàò ÏûàÏúºÎãà, ‚ÄúÌå®ÌÑ¥‚Äù Ï§ëÏã¨ÏúºÎ°ú ÌôúÏö©Ìï¥ Ï£ºÏÑ∏Ïöî.'
      ]
    });

    return sections;
  };

  const normalizeCustomSections = (raw) => {
    // Í∏∞ÎåÄ ÌòïÌÉú: [{title, bullets:[]}] / ÎòêÎäî [{title, items:[]}] ÏßÄÏõê
    return (raw || []).map((s, idx) => {
      const title = s?.title || `ÏÑπÏÖò ${idx + 1}`;
      const bullets = Array.isArray(s?.bullets) ? s.bullets : (Array.isArray(s?.items) ? s.items : []);
      return { title: String(title), bullets: bullets.map(x => String(x)) };
    }).filter(s => s.bullets.length);
  };

  const renderSections = (sections) => {
    return sections.map((sec) => {
      const title = escapeHtml(sec.title);
      const bullets = (sec.bullets || []).map(b => `<li>${escapeHtml(b)}</li>`).join('');
      return `<li class="report-sec"><div style="margin:12px 0 6px"><strong>${title}</strong></div><ul>${bullets}</ul></li>`;
    }).join('');
  };

  // ---------- choose content ----------
  const custom = data?.report?.[plan]?.sections || data?.reportSections?.[plan] || null;
  const sections = Array.isArray(custom) && custom.length
    ? normalizeCustomSections(custom)
    : buildGeneratedSections();

  const ul = document.getElementById('reportList');
  ul.innerHTML = renderSections(sections);

  // ---------- PDF ----------
  document.getElementById('btnPdf').onclick = async function () {
    const btn = this;
    btn.disabled = true;
    const prevLabel = btn.textContent;
    btn.textContent = 'PDF ÏÉùÏÑ± Ï§ë...';

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: 'mm', format: 'a4', orientation: 'p' });

    const reportCard = document.getElementById('reportCard');
    const btns = reportCard.querySelector('.btns');
    const prevDisplay = btns ? btns.style.display : '';
    if (btns) btns.style.display = 'none';

    try {
      const canvas = await html2canvas(reportCard, {
        backgroundColor: '#ffffff',
        scale: Math.min(window.devicePixelRatio || 1, 2),
        useCORS: true
      });

      const imgData = canvas.toDataURL('image/png');
      const pageWidth = doc.internal.pageSize.getWidth();
      const pageHeight = doc.internal.pageSize.getHeight();
      const imgHeight = (canvas.height * pageWidth) / canvas.width;
      let renderedHeight = 0;

      while (renderedHeight < imgHeight) {
        if (renderedHeight > 0) doc.addPage();
        doc.addImage(imgData, 'PNG', 0, -renderedHeight, pageWidth, imgHeight, undefined, 'FAST');
        renderedHeight += pageHeight;
      }

      doc.save(`${test || 'test'}_${result || 'result'}_${plan}_report.pdf`);
    } finally {
      if (btns) btns.style.display = prevDisplay;
      btn.disabled = false;
      btn.textContent = prevLabel;
    }
  };
})();
</script>

</body></html>
